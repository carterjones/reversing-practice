Vagrant.configure("2") do |config|
  config.vm.box = "bento/ubuntu-20.04"

  config.vm.provision "shell", inline: <<-SHELL
    apt-get update
    DEBIAN_FRONTEND=noninteractive apt-get install -y \
      binutils \
      bsdmainutils \
      gdb \
      nasm \
      python3 \
      wget \
      xxd
    rm -f /home/vagrant/.gdbinit
    echo set disassembly-flavor intel > /home/vagrant/.gdbinit
    if [[ ! -d "/opt/phoenix" ]]; then
      pushd /tmp
      wget https://github.com/ExploitEducation/Phoenix/releases/download/v1.0.0-alpha-3/exploit-education-phoenix_1.0.0-_amd64.deb
      dpkg -i exploit-education-phoenix_1.0.0-_amd64.deb
      rm exploit-education-phoenix_1.0.0-_amd64.deb
      popd
      pushd /home/vagrant
      ln -s /opt/phoenix/amd64/ phoenix
      popd
    fi
  SHELL
end
