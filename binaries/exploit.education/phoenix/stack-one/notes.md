# notes

stack:

```text
undefined         AL:1           <RETURN>
uint              Stack[-0x18]:4 changeme
char              Stack[-0x58]:1 dst_buffer
uint              Stack[-0x5c]:4 edi_backup
ulonglong         Stack[-0x68]:8 rsi_backup
```

exploitable code:

```text
004006a0 c7 45 f0 00 00 00 00    MOV        dword ptr [RBP + changeme],0x0                set changeme to zero
004006a7 48 8b 45 a0             MOV        RAX,qword ptr [RBP + rsi_backup]              rax = rsi_backup address
004006ab 48 83 c0 08             ADD        RAX,0x8                                       rax = arg1
004006af 48 8b 10                MOV        RDX,qword ptr [RAX]                           rdx = address of arg1
004006b2 48 8d 45 b0             LEA        RAX=>dst_buffer,[RBP + -0x50]                 rax = address of dst_buffer
004006b6 48 89 d6                MOV        src,RDX                                       rsi = address of arg1
004006b9 48 89 c7                MOV        dst,RAX                                       dst = dst_buffer
004006bc e8 df fd ff ff          CALL       <EXTERNAL>::strcpy                            strcpy(dst_buffer, arg1)
004006c1 8b 45 f0                MOV        EAX,dword ptr [RBP + changeme]
004006c4 3d 62 59 6c 49          CMP        EAX,0x496c5962                                IlYb
004006c9 75 0c                   JNZ        getting_closer
004006cb bf d8 07 40 00          MOV        dst=>s_success,s_success                      = "Well done, you have successfu
004006d0 e8 eb fd ff ff          CALL       <EXTERNAL>::puts                              int puts(char * __s)
004006d5 eb 14                   JMP        done
```

```c
void main(int argc,long argv1)
{
  ulonglong rsi_backup;
  uint edi_backup;
  char dst_buffer;
  uint changeme;

  puts("Welcome to phoenix/stack-one, brought to you by https://exploit.education");
  if (argc < 2) {
    errx(1,"specify an argument, to be copied into the \"buffer\"");
  }
  changeme = 0;
  strcpy(&dst_buffer,*(char **)(argv1 + 8));
  if (changeme == 0x496c5962) {
    puts("Well done, you have successfully set changeme to the correct value");
  }
  else {
    printf("Getting closer! changeme is currently 0x%08x, we want 0x496c5962\n",(ulong)changeme);
  }
                    /* WARNING: Subroutine does not return */
  exit(0);
}
```
